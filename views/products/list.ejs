<!DOCTYPE html>
<html>
<head>
  <title>Product List</title>
  <link rel="stylesheet" href="/css/style.css">
</head>
<body>
  <h1>Product List</h1>

  <% if (products && products.length > 0) { %>
    <table>
      <thead>
        <tr>
          <th>Product Name</th>
          <th>Description</th>
          <th>Quantity</th>
          <th>Added By</th>
          <th>Added At</th>
          <% if (userRole === 'admin' || userRole === 'monitor') { %>
            <th>Actions</th>
          <% } %>
        </tr>
      </thead>
      <tbody>
        <% products.forEach(product => { %>
          <tr>
            <td><%= product.product_name %></td>
            <td><%= product.description %></td>
            <td><%= product.quantity %></td>
            <td><%= product.added_by %></td> <%-- Displaying user ID for now, will need to join with users table --%>
            <td><%= product.added_at %></td>
            <% if (userRole === 'admin' || userRole === 'monitor') { %>
              <td>
                <a href="/<%= userRole %>/products/edit/<%= product.product_id %>">Edit</a>
                <form action="/<%= userRole %>/products/delete/<%= product.product_id %>" method="POST" style="display: inline;" onsubmit="return confirm('Are you sure you want to delete this product?');">
                  <button type="submit">Delete</button>
                </form>
              </td>
            <% } %>
          </tr>
        <% }); %>
      </tbody>
    </table>
  <% } else { %>
    <p>No products found.</p>
  <% } %>

  <% if (userRole === 'admin' || userRole === 'monitor') { %>
    <h2>Add New Product</h2>
    <form action="/<%= userRole %>/products/add" method="POST">
      <div>
        <label for="product_name">Product Name:</label>
        <input type="text" id="product_name" name="product_name" required>
      </div>
      <div>
        <label for="description">Description:</label>
        <textarea id="description" name="description"></textarea>
      </div>
      <div>
        <label for="quantity">Quantity:</label>
        <input type="number" id="quantity" name="quantity" required>
      </div>
      <%-- added_by will be determined from the logged-in user --%>
      <button type="submit">Add Product</button>
    </form>
  <% } %>

  <% if (userRole === 'admin') { %>
    <p><a href="/admin/dashboard">Back to Admin Dashboard</a></p>
  <% } else if (userRole === 'monitor') { %>
     <p><a href="/monitor/dashboard">Back to Monitor Dashboard</a></p>
  <% } %>
</body>
</html>